var m=function e(t,n){function r(e){A=e.document,S=e.location,M=e.cancelAnimationFrame||e.clearTimeout,R=e.requestAnimationFrame||e.setTimeout}function o(){var e,t=[].slice.call(arguments),n=!(null==t[1]||I.call(t[1])!==D||"tag"in t[1]||"view"in t[1]||"subtree"in t[1]),r=n?t[1]:{},o="class"in r?"class":"className",a={tag:"div",attrs:{}},l=[];if(I.call(t[0])!=B)throw Error("selector in m(selector, attrs, children) should be a string");for(;e=U.exec(t[0]);)if(""===e[1]&&e[2])a.tag=e[2];else if("#"===e[1])a.attrs.id=e[2];else if("."===e[1])l.push(e[2]);else if("["===e[3][0]){var i=q.exec(e[3]);a.attrs[i[1]]=i[3]||(i[2]?"":!0)}l.length>0&&(a.attrs[o]=l.join(" "));var u=t.slice(n?2:1);a.children=1===u.length&&I.call(u[0])===L?u[0]:u;for(var s in r)s===o?""!==r[s]&&(a.attrs[s]=(a.attrs[s]||"")+" "+r[s]):a.attrs[s]=r[s];return a}function a(e,t,r,o,s,d,f,h,m,p,g){try{(null==s||""+s==null)&&(s="")}catch(v){s=""}if("retain"===s.subtree)return d;var y=I.call(d),w=I.call(s);if(null==d||y!==w){if(null!=d)if(r&&r.nodes){var x=h-o,E=x+(w===L?s:d.nodes).length;u(r.nodes.slice(x,E),r.slice(x,E))}else d.nodes&&u(d.nodes,d);d=new s.constructor,d.tag&&(d={}),d.nodes=[]}if(w===L){for(var N=0,C=s.length;C>N;N++)I.call(s[N])===L&&(s=s.concat.apply([],s),N--,C=s.length);for(var b=[],k=d.length===s.length,O=0,T=1,j=2,S=3,R={},M=[],U=!1,N=0;N<d.length;N++)d[N]&&d[N].attrs&&null!=d[N].attrs.key&&(U=!0,R[d[N].attrs.key]={action:T,index:N});if(U){s.indexOf(null)>-1&&(s=s.filter(function(e){return null!=e}));var q=!1;if(s.length!=d.length)q=!0;else for(var H,J,N=0;H=d[N],J=s[N];N++)if(H.attrs&&J.attrs&&H.attrs.key!=J.attrs.key){q=!0;break}if(q){for(var N=0,C=s.length;C>N;N++)if(s[N]&&s[N].attrs)if(null!=s[N].attrs.key){var K=s[N].attrs.key;R[K]=R[K]?{action:S,index:N,from:R[K].index,element:d.nodes[R[K].index]||A.createElement("div")}:{action:j,index:N}}else M.push({index:N,element:e.childNodes[N]||A.createElement("div")});var F=[];for(var G in R)F.push(R[G]);for(var P,V=F.sort(l),_=Array(d.length),N=0;P=V[N];N++){if(P.action===T&&(u(d[P.index].nodes,d[P.index]),_.splice(P.index,1)),P.action===j){var Y=A.createElement("div");Y.key=s[P.index].attrs.key,e.insertBefore(Y,e.childNodes[P.index]||null),_.splice(P.index,0,{attrs:{key:s[P.index].attrs.key},nodes:[Y]})}P.action===S&&(e.childNodes[P.index]!==P.element&&null!==P.element&&e.insertBefore(P.element,e.childNodes[P.index]||null),_[P.index]=d[P.from])}for(var N=0,C=M.length;C>N;N++){var P=M[N];e.insertBefore(P.element,e.childNodes[P.index]||null),_[P.index]=d[P.index]}d=_,d.nodes=Array(e.childNodes.length);for(var W,N=0;W=e.childNodes[N];N++)d.nodes[N]=W}}for(var N=0,X=0,C=s.length;C>N;N++){var Z=a(e,t,d,h,s[N],d[X],f,h+O||O,m,p,g);Z!==n&&(Z.nodes.intact||(k=!1),O+=Z.$trusted?(Z.match(/<[^\/]|\>\s*[^<]|&/g)||[]).length:I.call(Z)===L?Z.length:1,d[X++]=Z)}if(!k){for(var N=0,C=s.length;C>N;N++)null!=d[N]&&b.push.apply(b,d[N].nodes);for(var et,N=0;et=d.nodes[N];N++)null!=et.parentNode&&b.indexOf(et)<0&&u([et],[d[N]]);s.length<d.length&&(d.length=s.length),d.nodes=b}}else if(null!=s&&w===D){if(s.view){var tt,rt=s,ot=d.controller||new(rt.controller||function(){});if(s=0==nt?rt.view(ot):{tag:"placeholder"},ot.onunload&&Q.push({controller:ot,handler:ot.onunload}),!s.tag)throw Error("Component template must return a virtual element, not an array, string, etc.")}s.attrs||(s.attrs={}),d.attrs||(d.attrs={});var at=Object.keys(s.attrs),lt=at.length>("key"in s.attrs?1:0);if((s.tag!=d.tag||at.join()!=Object.keys(d.attrs).join()||s.attrs.id!=d.attrs.id||s.attrs.key!=d.attrs.key)&&(d.nodes.length&&u(d.nodes),d.configContext&&typeof d.configContext.onunload===$&&d.configContext.onunload(),d.controller&&typeof d.controller.onunload===$&&d.controller.onunload({preventDefault:function(){}})),I.call(s.tag)!=B)return;var et,it=0===d.nodes.length;if(s.attrs.xmlns?p=s.attrs.xmlns:"svg"===s.tag?p="http://www.w3.org/2000/svg":"math"===s.tag&&(p="http://www.w3.org/1998/Math/MathML"),it){if(et=s.attrs.is?p===n?A.createElement(s.tag,s.attrs.is):A.createElementNS(p,s.tag,s.attrs.is):p===n?A.createElement(s.tag):A.createElementNS(p,s.tag),d={tag:s.tag,attrs:lt?i(et,s.tag,s.attrs,{},p):s.attrs,children:null!=s.children&&s.children.length>0?a(et,s.tag,n,n,s.children,d.children,!0,0,s.attrs.contenteditable?et:m,p,g):s.children,nodes:[et]},ot&&(d.controller=ot,ot.onunload&&ot.onunload.$old&&(ot.onunload=ot.onunload.$old),nt&&ot.onunload)){var tt=ot.onunload;ot.onunload=function(){},ot.onunload.$old=tt}d.children&&!d.children.nodes&&(d.children.nodes=[]),"select"===s.tag&&s.attrs.value&&i(et,s.tag,{value:s.attrs.value},{},p),e.insertBefore(et,e.childNodes[h]||null)}else et=d.nodes[0],lt&&i(et,s.tag,s.attrs,d.attrs,p),d.children=a(et,s.tag,n,n,s.children,d.children,!1,0,s.attrs.contenteditable?et:m,p,g),d.nodes.intact=!0,f===!0&&null!=et&&e.insertBefore(et,e.childNodes[h]||null);if(typeof s.attrs.config===$){var ut=d.configContext=d.configContext||{},st=function(e,t){return function(){return e.attrs.config.apply(e,t)}};g.push(st(s,[et,!it,ut,d]))}}else if(typeof w!=$){var b;0===d.nodes.length?(s.$trusted?b=c(e,h,s):(b=[A.createTextNode(s)],e.nodeName.match(z)||e.insertBefore(b[0],e.childNodes[h]||null)),d="string number boolean".indexOf(typeof s)>-1?new s.constructor(s):s,d.nodes=b):d.valueOf()!==s.valueOf()||f===!0?(b=d.nodes,m&&m===A.activeElement||(s.$trusted?(u(b,d),b=c(e,h,s)):"textarea"===t?e.value=s:m?m.innerHTML=s:((1===b[0].nodeType||b.length>1)&&(u(d.nodes,d),b=[A.createTextNode(s)]),e.insertBefore(b[0],e.childNodes[h]||null),b[0].nodeValue=s)),d=new s.constructor(s),d.nodes=b):d.nodes.intact=!0}return d}function l(e,t){return e.action-t.action||e.index-t.index}function i(e,t,n,r,o){for(var a in n){var l=n[a],i=r[a];if(a in r&&i===l)"value"===a&&"input"===t&&e.value!=l&&(e.value=l);else{r[a]=l;try{if("config"===a||"key"==a)continue;if(typeof l===$&&0===a.indexOf("on"))e[a]=d(l,e);else if("style"===a&&null!=l&&I.call(l)===D){for(var u in l)(null==i||i[u]!==l[u])&&(e.style[u]=l[u]);for(var u in i)u in l||(e.style[u]="")}else null!=o?"href"===a?e.setAttributeNS("http://www.w3.org/1999/xlink","href",l):"className"===a?e.setAttribute("class",l):e.setAttribute(a,l):a in e&&"list"!==a&&"style"!==a&&"form"!==a&&"type"!==a?("input"!==t||e[a]!==l)&&(e[a]=l):e.setAttribute(a,l)}catch(s){if(s.message.indexOf("Invalid argument")<0)throw s}}}return r}function u(e,t){for(var n=e.length-1;n>-1;n--)if(e[n]&&e[n].parentNode){try{e[n].parentNode.removeChild(e[n])}catch(r){}t=[].concat(t),t[n]&&s(t[n])}0!=e.length&&(e.length=0)}function s(e){if(e.configContext&&typeof e.configContext.onunload===$&&e.configContext.onunload(),e.controller&&typeof e.controller.onunload===$&&e.controller.onunload({preventDefault:function(){}}),e.children)if(I.call(e.children)===L)for(var t,n=0;t=e.children[n];n++)s(t);else e.children.tag&&s(e.children)}function c(e,t,n){var r=e.childNodes[t];if(r){var o=1!=r.nodeType,a=A.createElement("span");o?(e.insertBefore(a,r||null),a.insertAdjacentHTML("beforebegin",n),e.removeChild(a)):r.insertAdjacentHTML("beforebegin",n)}else e.insertAdjacentHTML("beforeend",n);for(var l=[];e.childNodes[t]!==r;)l.push(e.childNodes[t]),t++;return l}function d(e,t){return function(n){n=n||event,o.redraw.strategy("diff"),o.startComputation();try{return e.call(t,n)}finally{rt()}}}function f(e){var t=K.indexOf(e);return 0>t?K.push(e)-1:t}function h(e){var t=function(){return arguments.length&&(e=arguments[0]),e};return t.toJSON=function(){return e},t}function m(e,t){var n=function(){return(e.controller||function(){}).apply(this,t)||this},r=function(n){arguments.length>1&&(t=t.concat([].slice.call(arguments,1)));var r=e.view.apply(e,t?[n].concat(t):[n]);return t[0]&&null!=t[0].key&&(r.attrs.key=t[0].key),r},o={controller:n,view:r};return t[0]&&null!=t[0].key&&(o.attrs={key:t[0].key}),o}function p(){for(var e,t="all"===o.redraw.strategy(),n=0;e=P[n];n++)if(_[n]){var r=V[n].controller&&V[n].controller.$$args?[_[n]].concat(V[n].controller.$$args):[_[n]];o.render(e,V[n].view?V[n].view(_[n],r):tt(),t)}X&&(X(),X=null),Y=null,W=new Date,o.redraw.strategy("diff")}function g(e){return e.slice(lt[o.route.mode].length)}function v(e,t,n){ot={};var r=n.indexOf("?");-1!==r&&(ot=E(n.substr(r+1,n.length)),n=n.substr(0,r));var a=Object.keys(t),l=a.indexOf(n);if(-1!==l)return o.module(e,t[a[l]]),!0;for(var i in t){if(i===n)return o.module(e,t[i]),!0;var u=RegExp("^"+i.replace(/:[^\/]+?\.{3}/g,"(.*?)").replace(/:[^\/]+/g,"([^\\/]+)")+"/?$");if(u.test(n))return n.replace(u,function(){for(var n=i.match(/:[^\/]+/g)||[],r=[].slice.call(arguments,1,-2),a=0,l=n.length;l>a;a++)ot[n[a].replace(/:|\./g,"")]=decodeURIComponent(r[a]);o.module(e,t[i])}),!0}}function y(e){if(e=e||event,!e.ctrlKey&&!e.metaKey&&2!==e.which){e.preventDefault?e.preventDefault():e.returnValue=!1;for(var t=e.currentTarget||e.srcElement,n="pathname"===o.route.mode&&t.search?E(t.search.slice(1)):{};t&&"A"!=t.nodeName.toUpperCase();)t=t.parentNode;o.route(t[o.route.mode].slice(lt[o.route.mode].length),n)}}function w(){"hash"!=o.route.mode&&S.hash?S.hash=S.hash:t.scrollTo(0,0)}function x(e,t){var n=[];for(var r in e){var o=t?t+"["+r+"]":r,a=e[r],l=I.call(a),i=null!=a&&l===D?x(a,o):l===L?a.map(function(e){return encodeURIComponent(o+"[]")+"="+encodeURIComponent(e)}).join("&"):encodeURIComponent(o)+"="+encodeURIComponent(a);n.push(i)}return n.join("&")}function E(e){for(var t=e.split("&"),n={},r=0,o=t.length;o>r;r++){var a=t[r].split("=");n[decodeURIComponent(a[0])]=a[1]?decodeURIComponent(a[1]):""}return n}function N(e){var t=f(e);u(e.childNodes,F[t]),F[t]=n}function C(e){var t=o.prop();return e.then(t),t.then=function(n,r){return e=e.then(n,r).then(t),t},t}function b(e,t){function n(e){d=e||s,h.map(function(e){d===u&&e.resolve(f)||e.reject(f)})}function r(e,t,n,r){if((null!=f&&I.call(f)===D||typeof f===$)&&typeof e===$)try{var a=0;e.call(f,function(e){a++||(f=e,t())},function(e){a++||(f=e,n())})}catch(l){o.deferred.onerror(l),f=l,n()}else r()}function a(){var s;try{s=f&&f.then}catch(h){return o.deferred.onerror(h),f=h,d=i,a()}r(s,function(){d=l,a()},function(){d=i,a()},function(){try{d===l&&typeof e===$?f=e(f):d===i&&"function"==typeof t&&(f=t(f),d=l)}catch(a){return o.deferred.onerror(a),f=a,n()}f===c?(f=TypeError(),n()):r(s,function(){n(u)},n,function(){n(d===l&&u)})})}var l=1,i=2,u=3,s=4,c=this,d=0,f=0,h=[];c.promise={},c.resolve=function(e){return d||(f=e,d=l,a()),this},c.reject=function(e){return d||(f=e,d=i,a()),this},c.promise.then=function(e,t){var n=new b(e,t);return d===u?n.resolve(f):d===s?n.reject(f):h.push(n),n.promise}}function k(e){return e}function O(e){if(!e.dataType||"jsonp"!==e.dataType.toLowerCase()){var r=new t.XMLHttpRequest;if(r.open(e.method,e.url,!0,e.user,e.password),r.onreadystatechange=function(){4===r.readyState&&(r.status>=200&&r.status<300?e.onload({type:"load",target:r}):e.onerror({type:"error",target:r}))},e.serialize===JSON.stringify&&e.data&&"GET"!==e.method&&r.setRequestHeader("Content-Type","application/json; charset=utf-8"),e.deserialize===JSON.parse&&r.setRequestHeader("Accept","application/json, text/*"),typeof e.config===$){var o=e.config(r,e);null!=o&&(r=o)}var a="GET"!==e.method&&e.data?e.data:"";if(a&&I.call(a)!=B&&a.constructor!=t.FormData)throw"Request data should be either be a string or FormData. Check the `serialize` option in `m.request`";return r.send(a),r}var l="mithril_callback_"+(new Date).getTime()+"_"+Math.round(1e16*Math.random()).toString(36),i=A.createElement("script");t[l]=function(r){i.parentNode.removeChild(i),e.onload({type:"load",target:{responseText:r}}),t[l]=n},i.onerror=function(){return i.parentNode.removeChild(i),e.onerror({type:"error",target:{status:500,responseText:JSON.stringify({error:"Error making jsonp request"})}}),t[l]=n,!1},i.onload=function(){return!1},i.src=e.url+(e.url.indexOf("?")>0?"&":"?")+(e.callbackKey?e.callbackKey:"callback")+"="+l+"&"+x(e.data||{}),A.body.appendChild(i)}function T(e,t,n){if("GET"===e.method&&"jsonp"!=e.dataType){var r=e.url.indexOf("?")<0?"?":"&",o=x(t);e.url=e.url+(o?r+o:"")}else e.data=n(t);return e}function j(e,t){var n=e.match(/:[a-z]\w+/gi);if(n&&t)for(var r=0;r<n.length;r++){var o=n[r].slice(1);e=e.replace(n[r],t[o]),delete t[o]}return e}var A,S,R,M,D="[object Object]",L="[object Array]",B="[object String]",$="function",I={}.toString,U=/(?:(^|#|\.)([^#\.\[\]]+))|(\[.+?\])/g,q=/\[(.+?)(?:=("|'|)(.*?)\2)?\]/,z=/^(AREA|BASE|BR|COL|COMMAND|EMBED|HR|IMG|INPUT|KEYGEN|LINK|META|PARAM|SOURCE|TRACK|WBR)$/;r(t);var H,J={appendChild:function(e){H===n&&(H=A.createElement("html")),A.documentElement&&A.documentElement!==e?A.replaceChild(e,A.documentElement):A.appendChild(e),this.childNodes=A.childNodes},insertBefore:function(e){this.appendChild(e)},childNodes:[]},K=[],F={};o.render=function(e,t,r){var o=[];if(!e)throw Error("Please ensure the DOM element exists before rendering a template into it.");var l=f(e),i=e===A,s=i||e===A.documentElement?J:e;i&&"html"!=t.tag&&(t={tag:"html",attrs:{},children:t}),F[l]===n&&u(s.childNodes),r===!0&&N(e),F[l]=a(s,null,n,n,t,F[l],!1,0,null,n,o);for(var c=0,d=o.length;d>c;c++)o[c]()},o.trust=function(e){return e=new String(e),e.$trusted=!0,e},o.prop=function(e){return(null!=e&&I.call(e)===D||typeof e===$)&&typeof e.then===$?C(e):h(e)};var G,P=[],V=[],_=[],Y=null,W=0,X=null,Q=[],Z=16;o.module=function(e,t){if(!e)throw Error("Please ensure the DOM element exists before rendering a template into it.");if(e.view)return m(e,[].slice.call(arguments,1));var n=P.indexOf(e);0>n&&(n=P.length);for(var r,a=!1,l={preventDefault:function(){a=!0}},i=0;r=Q[i];i++)r.handler(l),r.controller.onunload=null;if(a)for(var r,i=0;r=Q[i];i++)r.controller.onunload=r.handler;else Q=[];if(_[n]&&typeof _[n].onunload===$&&_[n].onunload(l),!a){o.redraw.strategy("all"),o.startComputation(),P[n]=e,arguments.length>2&&(t=m(t,[].slice.call(arguments,2)));var u=G=t=t||{},s=t.controller||function(){},c=new s;return u===G&&(_[n]=c,V[n]=t),rt(),_[n]}};var et=!1;o.redraw=function(e){et||(et=!0,Y&&e!==!0?(new Date-W>Z||R===t.requestAnimationFrame)&&(Y>0&&M(Y),Y=R(p,Z)):(p(),Y=R(function(){Y=null},Z)),et=!1)},o.redraw.strategy=o.prop();var tt=function(){return""},nt=0;o.startComputation=function(){nt++},o.endComputation=function(){nt=Math.max(nt-1,0),0===nt&&o.redraw()};var rt=function(){"none"==o.redraw.strategy()?(nt--,o.redraw.strategy("diff")):o.endComputation()};o.withAttr=function(e,t){return function(n){n=n||event;var r=n.currentTarget||this;t(e in r?r[e]:r.getAttribute(e))}};var ot,at,lt={pathname:"",hash:"#",search:"?"},it=function(){};return o.route=function(){if(0===arguments.length)return at;if(3===arguments.length&&I.call(arguments[1])===B){var e=arguments[0],n=arguments[1],r=arguments[2];it=function(t){var a=at=g(t);v(e,r,a)||o.route(n,!0)};var a="hash"===o.route.mode?"onhashchange":"onpopstate";t[a]=function(){var e=S[o.route.mode];"pathname"===o.route.mode&&(e+=S.search),at!=g(e)&&it(e)},X=w,t[a]()}else if(arguments[0].addEventListener||arguments[0].attachEvent){{var l=arguments[0];arguments[1],arguments[2]}l.href=("pathname"!==o.route.mode?S.pathname:"")+lt[o.route.mode]+this.attrs.href,l.addEventListener?(l.removeEventListener("click",y),l.addEventListener("click",y)):(l.detachEvent("onclick",y),l.attachEvent("onclick",y))}else if(I.call(arguments[0])===B){var i=at;at=arguments[0];var u=arguments[1]||{},s=at.indexOf("?"),c=s>-1?E(at.slice(s+1)):{};for(var d in u)c[d]=u[d];var f=x(c),h=s>-1?at.slice(0,s):at;f&&(at=h+(-1===h.indexOf("?")?"?":"&")+f);var m=(3===arguments.length?arguments[2]:arguments[1])===!0||i===arguments[0];t.history.pushState?(X=function(){t.history[m?"replaceState":"pushState"](null,A.title,lt[o.route.mode]+at),w()},it(lt[o.route.mode]+at)):(S[o.route.mode]=at,it(lt[o.route.mode]+at))}},o.route.param=function(e){if(!ot)throw Error("You must call m.route(element, defaultRoute, routes) before calling m.route.param()");return ot[e]},o.route.mode="search",o.deferred=function(){var e=new b;return e.promise=C(e.promise),e},o.deferred.onerror=function(e){if("[object Error]"===I.call(e)&&!(""+e.constructor).match(/ Error/))throw e},o.sync=function(e){function t(e,t){return function(o){return l[e]=o,t||(n="reject"),0===--a&&(r.promise(l),r[n](l)),o}}var n="resolve",r=o.deferred(),a=e.length,l=Array(a);if(e.length>0)for(var i=0;i<e.length;i++)e[i].then(t(i,!0),t(i,!1));else r.resolve([]);return r.promise},o.request=function(e){e.background!==!0&&o.startComputation();var t=o.deferred(),n=e.dataType&&"jsonp"===e.dataType.toLowerCase(),r=e.serialize=n?k:e.serialize||JSON.stringify,a=e.deserialize=n?k:e.deserialize||JSON.parse,l=e.extract||function(e){return 0===e.responseText.length&&a===JSON.parse?null:e.responseText};return e.url=j(e.url,e.data),e=T(e,e.data,r),e.onload=e.onerror=function(n){try{n=n||event;var r=("load"===n.type?e.unwrapSuccess:e.unwrapError)||k,i=r(a(l(n.target,e)),n.target);if("load"===n.type)if(I.call(i)===L&&e.type)for(var u=0;u<i.length;u++)i[u]=new e.type(i[u]);else e.type&&(i=new e.type(i));t["load"===n.type?"resolve":"reject"](i)}catch(n){o.deferred.onerror(n),t.reject(n)}e.background!==!0&&o.endComputation()},O(e),t.promise(e.initialValue),t.promise},o.deps=function(e){return r(t=e||t),t},o.deps.factory=e,o}("undefined"!=typeof window?window:{});"undefined"!=typeof module&&null!==module&&module.exports?module.exports=m:"function"==typeof define&&define.amd&&define(function(){return m});
