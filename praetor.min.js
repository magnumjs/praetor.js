/*
Praetor v0.1.1
http://github.com/magnumjs/praetor.js
(c) Michael Glazer
License: MIT
*/
var JSONPath=require("JSONPath"),p=function(t,e){"use strict";function n(t,n){for(var r in n)t[r]=t[r]===e?n[r]:t[r];return t}function r(t,n,r){var o=Function(n.codeBody);for(var s in n.parms)r[s]=r[s]===e?n.parms[s]:r[s];var i={results:t,params:r},u=o.apply(i);return u?u:i.results}function o(t,e,r){o.setOptions(r,e);var s=n(t,JSON.parse(JSON.stringify(u)));o.map(e,s)}var s=function(t,e){for(var n in e)"object"!=typeof t[n]?t[n]=e[n]:"object"==typeof e[n]&&(t[n]=s(t[n],e[n]));return t},i={};i.stores={},i.queries={},i.procs={};var u=function(){return JSON.parse(JSON.stringify(i))}(),a={jsonPathOptions:{}},c={},p={},f="[object Object]",d={}.toString;return o.setOptions=function(t,e){c=t,o.settings(t,e)},o.getOptions=function(){return c},o.settings=function(t){return p=s(a,t)},o.map=function(t,e){return this.state=this.state||{},t&&d.call(t)!==f?(this.state[t]||(this.state[t]=e||JSON.parse(JSON.stringify(u))),this.state[t]):(this.state[o.id]=e||this.state[o.id]||i,this.state[o.id])},o.proc=function(t,e,n,s){var i=e.map(function(e){return JSONPath(o.settings().jsonPathOptions,t,e)}),u={parms:s,codeBody:n};return r(i,u,s)},o.setDataStore=function(t,e,n){o.map(n).stores[t]=e},o.getDataStore=function(t,e){return o.map(e).stores[t]},o.setJsonQuery=function(t,e,n,r){o.map(r).queries[t]={query:e,store:n}},o.getJsonQuery=function(t,e){return o.map(e).queries[t]},o.getJsonQueryResult=function(t,e){var n=o.getJsonQuery(t,e),r=o.getDataStore(n.store,e),s=JSONPath(o.settings().jsonPathOptions,r,n.query);return s},o.setStoredProc=function(t,e,n,r,s){o.map(s).procs[t]={namedQueries:e,codeBody:n,parms:r}},o.getStoredProc=function(t,e){return o.map(e).procs[t]},o.getStoredProcResult=function(t,e,n){var s=o.getStoredProc(t,n),i=[];return i=s.namedQueries.map(function(t){var e={};return e[t]=o.getJsonQueryResult(t,n),e}),r(i,s,e)},o.setState=function(t,e){o.map(t,e)},o.getState=function(t){return JSON.parse(JSON.stringify(o.map(t)))},o}("undefined"!=typeof window?window:{});"undefined"!=typeof module&&null!==module&&module.exports?module.exports=p:"function"==typeof define&&define.amd&&define(function(){return p});
