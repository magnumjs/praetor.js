/* Praeter.js 0.1 - Stored Procedures (JS Code blocks) for JSON results via XPath JSON
 *
 * Copyright (c) 2015 Michael Glazer (https://github.com/magnumjs/praetor.js)
 * Licensed under the MIT (MIT-LICENSE.txt) licence.
 */
var p=function(t,e,r){"use strict";function n(t,e){for(var n in e)t[n]=t[n]===r?e[n]:t[n];return t}function a(t,e,n){var a=Function(e.codeBody);for(var o in e.parms)n[o]=n[o]===r?e.parms[o]:n[o];var s={results:t,params:n},i=a.apply(s);return i?i:s.results}function o(t,e,r){o.setOptions(r,e);var a=n(t,JSON.parse(JSON.stringify(c)));o.map(e,a)}var s="undefined"!=typeof module&&!!module.exports;if(e=r!==e?e:s&&t&&"function"==typeof t?t("jsonpath"):null,!e)throw Error("JSONPath is required: (https://github.com/s3u/JSONPath)");var i=function(t,e){for(var r in e)"object"!=typeof t[r]?t[r]=e[r]:"object"==typeof e[r]&&(t[r]=i(t[r],e[r]));return t},u={};u.stores={},u.queries={},u.procs={};var c=function(){return JSON.parse(JSON.stringify(u))}(),p={jsonPathOptions:{}},f={},l={},h="[object Object]",d={}.toString;return o.setOptions=function(t,e){f=t,o.settings(t,e)},o.getOptions=function(){return f},o.settings=function(t){return l=i(p,t)},o.map=function(t,e){return this.state=this.state||{},t&&d.call(t)!==h?(this.state[t]||(this.state[t]=e||JSON.parse(JSON.stringify(c))),this.state[t]):(this.state[o.id]=e||this.state[o.id]||u,this.state[o.id])},o.proc=function(t,r,n,s){var i=r.map(function(r){return e(o.settings().jsonPathOptions,t,r)}),u={parms:s,codeBody:n};return a(i,u,s)},o.setDataStore=function(t,e,r){o.map(r).stores[t]=e},o.getDataStore=function(t,e){return o.map(e).stores[t]},o.setJsonQuery=function(t,e,r,n){o.map(n).queries[t]={query:e,store:r}},o.getJsonQuery=function(t,e){return o.map(e).queries[t]},o.getJsonQueryResult=function(t,r){var n=o.getJsonQuery(t,r),a=o.getDataStore(n.store,r),s=e(o.settings().jsonPathOptions,a,n.query);return s},o.setStoredProc=function(t,e,r,n,a){o.map(a).procs[t]={namedQueries:e,codeBody:r,parms:n}},o.getStoredProc=function(t,e){return o.map(e).procs[t]},o.getStoredProcResult=function(t,e,r){var n=o.getStoredProc(t,r),s=[];return s=n.namedQueries.map(function(t){var e={};return e[t]=o.getJsonQueryResult(t,r),e}),a(s,n,e)},o.setState=function(t,e){o.map(t,e)},o.getState=function(t){return JSON.parse(JSON.stringify(o.map(t)))},o}("undefined"==typeof require?null:require,"undefined"==typeof jsonpath?"undefined"==typeof JSONPath?null:JSONPath:jsonpath);"undefined"!=typeof module&&null!==module&&module.exports?module.exports=p:"function"==typeof define&&define.amd&&define("jsonpath",function(){return p});