/* Praeter.js 0.1 - Stored Procedures (JS Code blocks) for JSON results via XPath JSON
 *
 * Copyright (c) 2015 Michael Glazer (https://github.com/magnumjs/praetor.js)
 * Licensed under the MIT (MIT-LICENSE.txt) licence.
 */
var p=function(t,e,n){"use strict";function r(t,e){for(var r in e)t[r]=t[r]===n?e[r]:t[r];return t}function o(t,e,r){var o=Function(e.codeBody);for(var s in e.parms)r[s]=r[s]===n?e.parms[s]:r[s];var i={results:t,params:r},u=o.apply(i);return u?u:i.results}function s(t,e,n){s.setOptions(n,e);var o=r(t,JSON.parse(JSON.stringify(p)));s.map(e,o)}var i="undefined"!=typeof module&&!!module.exports;if(e=n!==e?e:i&&t&&"function"==typeof t?t("jsonpath"):n,!e)throw Error("JSONPath is required: (https://github.com/s3u/JSONPath)");var u=function(t,e){for(var n in e)"object"!=typeof t[n]?t[n]=e[n]:"object"==typeof e[n]&&(t[n]=u(t[n],e[n]));return t},a={};a.stores={},a.queries={},a.procs={};var p=function(){return JSON.parse(JSON.stringify(a))}(),f={jsonPathOptions:{}},c={},d={},m="[object Object]",y={}.toString;return s.setOptions=function(t,e){c=t,s.settings(t,e)},s.getOptions=function(){return c},s.settings=function(t){return d=u(f,t)},s.map=function(t,e){return this.state=this.state||{},t&&y.call(t)!==m?(this.state[t]||(this.state[t]=e||JSON.parse(JSON.stringify(p))),this.state[t]):(this.state[s.id]=e||this.state[s.id]||a,this.state[s.id])},s.proc=function(t,n,r,i){var u=n.map(function(n){return e(s.settings().jsonPathOptions,t,n)}),a={parms:i,codeBody:r};return o(u,a,i)},s.setDataStore=function(t,e,n){s.map(n).stores[t]=e},s.getDataStore=function(t,e){return s.map(e).stores[t]},s.setJsonQuery=function(t,e,n,r){s.map(r).queries[t]={query:e,store:n}},s.getJsonQuery=function(t,e){return s.map(e).queries[t]},s.getJsonQueryResult=function(t,n){var r=s.getJsonQuery(t,n),o=s.getDataStore(r.store,n),i=e(s.settings().jsonPathOptions,o,r.query);return i},s.setStoredProc=function(t,e,n,r,o){s.map(o).procs[t]={namedQueries:e,codeBody:n,parms:r}},s.getStoredProc=function(t,e){return s.map(e).procs[t]},s.getStoredProcResult=function(t,e,n){var r=s.getStoredProc(t,n),i=[];return i=r.namedQueries.map(function(t){var e={};return e[t]=s.getJsonQueryResult(t,n),e}),o(i,r,e)},s.setState=function(t,e){s.map(t,e)},s.getState=function(t){return JSON.parse(JSON.stringify(s.map(t)))},s}("undefined"==typeof require?void 0:require,"undefined"==typeof jsonpath?"undefined"==typeof JSONPath?void 0:JSONPath:jsonpath);"undefined"!=typeof module&&null!==module&&module.exports?module.exports=p:"function"==typeof define&&define.amd&&define("",["jsonpath"],function(){return p});